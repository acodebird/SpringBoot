webpackJsonp([5],{"P1y/":function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=e("W8/L"),s=e.n(i),n=e("PJh5"),o=e.n(n),r=e("aNLv"),l=e("lb5x"),c=e("M9A7"),d={name:"VaildEmail",data:function(){return{email:"111",captchaInfo:{code:"",token:""},form:this.$form.createForm(this),visible:!1,confirmLoading:!1}},methods:{show:function(t){this.getCaptcha(t),this.email=t,this.visible=!0},handleOk:function(){var t=this;this.form.validateFields({force:!0},function(a,e){a?console.log("VaildEmail.form.validateFields",a):(t.captchaInfo.code=e.captcha,t.confirmLoading=!0,Object(c.k)(t.captchaInfo).then(function(a){if(t.confirmLoading=!1,!0===a.success)return t.$notification.success({message:"邮箱验证通过"}),t.visible=!1,t.form.resetFields(),void t.$emit("vaild");t.$notification.error({message:l.a[a.data]})}).catch(function(a){confirmLoading=!1,t.$notification.error({message:"请求出现错误，请稍后再试"}),console.log("updateInfo error",a.message)}))})},handleCancel:function(){this.visible=!1,this.captchaInfo.code="",this.form.resetFields()},getCaptcha:function(t){var a=this;return Object(c.g)(t).then(function(e){if(!0===e.success)return a.visible=!0,a.captchaInfo=e.data,void a.$notification.success({message:"验证码已发送到邮箱: "+t});a.$notification.error({message:"验证码发送失败: "+l.a[e.data]})}).catch(function(t){console.log("请求出现错误，请稍后再试",t.message),a.$notification.error({message:"请求出现错误，请稍后再试"})})},handleValidCaptcha:function(t,a,e){void 0===a&&e("请输入验证码"),4!=a.length&&e("请输入4位验证码"),a!==this.captchaInfo.code&&e("验证码不正确"),e()}}},f={render:function(){var t=this.$createElement,a=this._self._c||t;return a("div",[a("a-modal",{attrs:{title:"验证邮箱",cancelText:"取消",okText:"验证",visible:this.visible,confirmLoading:this.confirmLoading},on:{ok:this.handleOk,cancel:this.handleCancel}},[a("a-form",{attrs:{form:this.form}},[a("a-form-item",{attrs:{"wrapper-col":{span:20},"has-feedback":""}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["captcha",{rules:[{required:!0,message:" "},{validator:this.handleValidCaptcha}],validateTrigger:["change","blur"]}],expression:"['captcha', {rules: [{ required: true, message: ' ' },{ validator: this.handleValidCaptcha }], validateTrigger: ['change', 'blur']}]"}],attrs:{type:"text",placeholder:"验证码"}})],1)],1)],1)],1)},staticRenderFns:[]};var u={0:{text:"普通用户"},1:{text:"管理员"}},h={true:{text:"启用"},false:{text:"停用"}},m={name:"UserInfomation",components:{VaildEmail:e("VU/8")(d,f,!1,function(t){e("bQmz")},"data-v-7c16efdf",null).exports},data:function(){return{zh_CN:s.a,isEdit:!1,formLayout:"horizontal",sourceEmail:"",info:{uname:"",telephone:"",email:"",type:0,icon:"/upload/user/avatar/default_avatar.jpeg",enable:!0},hideMessage:0,headers:{authorization:"authorization-text"}}},methods:{moment:o.a,handleCancel:function(){this.info=r.e,this.isEdit=!1},handleVaild:function(){this.sourceEmail===this.info.email?this.handleSubmit():this.$refs.vaildModal.show(this.info.email)},handleSubmit:function(){var t=this;this.valid()&&(this.hideMessage=this.$message.loading("保存中...",0),Object(c.i)(this.info).then(function(a){if(setTimeout(t.hideMessage),!0===a.success)return Object(r.d)(t.info),t.sourceEmail=t.info.email,t.$notification.success({message:"用户信息已更新"}),t.isEdit=!1,void t.$router.go(0);t.$notification.error({message:l.a[a.data]})}).catch(function(a){setTimeout(t.hideMessage),t.$notification.error({message:"请求出现错误，请稍后再试"}),console.log("updateInfo error",a.message)}))},handleEdit:function(){this.isEdit=!0},valid:function(){var t=!0;return/^[A-Za-z][a-zA-Z0-9_]{5,15}$/.test(this.info.uname)||(this.$notification.error({message:"用户名为6到16位（字母，数字，下划线）只能以字母开头!"}),t=!1),/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/.test(this.info.email)||(this.$notification.error({message:"邮箱格式不正确!"}),t=!1),/^((13[0-9])|(14[5|7])|(15([0-3]|[5-9]))|(18[0,5-9]))\d{8}$/.test(this.info.telephone)||(this.$notification.error({message:"手机号格式不正确!"}),t=!1),t},handleChangeAvatar:function(){console.log(this.$refs.avatar),this.$refs.avatar.click()},changeAvatar:function(){var t=this;if(/(\.*.jpg$)|(\.*.png$)|(\.*.jpeg$)|(\.*.gif$)|(\.*.bmp$)/.test(this.$refs.avatar.value)){var a=new window.FormData;a.append("multipartFile",document.querySelector("input[type=file]").files[0]),Object(c.h)(a).then(function(a){if(!0===a.success)return t.$notification.success({message:"头像更新成功"}),void t.$router.go(0);t.$notification.error({message:l.a[a.data]})}).catch(function(a){setTimeout(t.hideMessage),t.$notification.error({message:"请求出现错误，请稍后再试"}),console.log("updateInfo error",a.message)})}else this.$notification.error({message:"仅支持jpg/jpeg/png/gif/bmp格式的头像！"})}},created:function(){var t=this;if(null!==r.e)return this.info=r.e,void(this.sourceEmail=r.e.email);Object(c.c)().then(function(a){if(!0===a.success)return t.info=a.data,Object(r.d)(a.data),void(t.sourceEmail=a.data.email);console.log("isLogin error",l.a[a.data]),t.info=null,t.$router.push("/login")}).catch(function(t){console.log("isLogin error",t.message)})},filters:{typeFilter:function(t){return u[t].text},statusFilter:function(t){return h[t].text}}},p={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("a-locale-provider",{attrs:{locale:t.zh_CN}},[e("a-card",{attrs:{busered:!1,bordered:!1}},[e("div",{staticClass:"main"},[e("div",{staticClass:"tit"},[e("h4",[t._v("基本信息")])]),t._v(" "),e("div",{staticClass:"section"},[e("a-row",{staticStyle:{"margin-top":"50px"},attrs:{type:"flex",justify:"space-around",align:"middle"}},[e("a-col",{attrs:{span:16}},[e("a-row",[e("a-col",{staticClass:"label-name",attrs:{span:4}},[t._v("用户名:")]),t._v(" "),e("a-col",{attrs:{span:16}},[t.isEdit?e("a-input",{attrs:{placeholder:"用户名"},model:{value:t.info.uname,callback:function(a){t.$set(t.info,"uname",a)},expression:"info.uname"}}):e("p",{staticStyle:{"margin-top":"4px"}},[t._v(t._s(t.info.uname))])],1)],1),t._v(" "),e("a-row",{staticStyle:{"margin-top":"15px"}},[e("a-col",{staticClass:"label-name",attrs:{span:4}},[t._v("邮箱：")]),t._v(" "),e("a-col",{attrs:{span:16}},[t.isEdit?e("a-input",{attrs:{placeholder:"邮箱",maxlength:"18"},model:{value:t.info.email,callback:function(a){t.$set(t.info,"email",a)},expression:"info.email"}}):e("p",{staticStyle:{"margin-top":"4px"}},[t._v(t._s(t.info.email))])],1)],1),t._v(" "),e("a-row",{staticStyle:{"margin-top":"15px"}},[e("a-col",{staticClass:"label-name",attrs:{span:4}},[t._v("手机：")]),t._v(" "),e("a-col",{attrs:{span:16}},[t.isEdit?e("a-input",{attrs:{placeholder:"仅大陆手机号码",maxlength:"11"},model:{value:t.info.telephone,callback:function(a){t.$set(t.info,"telephone",a)},expression:"info.telephone"}}):e("p",{staticStyle:{"margin-top":"4px"}},[t._v(t._s(t.info.telephone))])],1)],1),t._v(" "),e("a-row",{staticStyle:{"margin-top":"15px"}},[e("a-col",{staticClass:"label-name",attrs:{span:4}},[t._v("账号类型：")]),t._v(" "),e("a-col",{attrs:{span:16}},[t.isEdit?e("a-input",{attrs:{disabled:!0,placeholder:"账号类型"}}):e("p",{staticStyle:{"margin-top":"4px"}},[t._v(t._s(t._f("typeFilter")(t.info.type)))])],1)],1),t._v(" "),e("a-row",{staticStyle:{"margin-top":"15px"}},[e("a-col",{staticClass:"label-name",attrs:{span:4}},[t._v("账号状态：")]),t._v(" "),e("a-col",{attrs:{span:16}},[t.isEdit?e("a-input",{attrs:{disabled:!0,placeholder:"账号状态"}}):e("p",{staticStyle:{"margin-top":"4px"}},[t._v(t._s(t._f("statusFilter")(t.info.enable)))])],1)],1)],1),t._v(" "),e("a-col",{attrs:{span:8}},[e("a-row",{staticStyle:{"margin-top":"50px","margin-bottom":"20px"},attrs:{type:"flex",justify:"space-around",align:"middle"}},[e("a-avatar",{attrs:{shape:"square",size:128,icon:"user",src:t.info.icon}})],1),t._v(" "),t.isEdit?e("a-row",{attrs:{type:"flex",justify:"space-around",align:"middle"}},[e("input",{ref:"avatar",staticClass:"file",attrs:{type:"file",hidden:"hidden"},on:{change:t.changeAvatar}}),t._v(" "),e("a-button",{on:{click:t.handleChangeAvatar}},[e("a-icon",{attrs:{type:"upload"}}),t._v(" 修改头像\r\n                ")],1)],1):t._e()],1)],1),t._v(" "),e("div",{staticClass:"btn-box"},[t.isEdit?e("a-button",{staticClass:"btn",on:{click:t.handleCancel}},[t._v("取消")]):t._e(),t._v(" "),t.isEdit?e("a-button",{staticClass:"btn",attrs:{type:"primary"},on:{click:t.handleVaild}},[t._v("保存")]):e("a-button",{staticClass:"btn",attrs:{type:"primary"},on:{click:t.handleEdit}},[t._v("编辑")])],1)],1)]),t._v(" "),e("vaild-email",{ref:"vaildModal",on:{vaild:t.handleSubmit}})],1)],1)},staticRenderFns:[]};var v=e("VU/8")(m,p,!1,function(t){e("v96v")},"data-v-c67e4350",null);a.default=v.exports},bQmz:function(t,a){},v96v:function(t,a){}});
//# sourceMappingURL=5.f9f68e4458d12bba4e45.js.map